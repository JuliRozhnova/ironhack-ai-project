<div class="row">
  <div class="col s12">
    <a href="/storage">Go back to storage</a>
  </div>
</div>

{{#if emotions}}
<div class="row">
  <div class="col s12">
    <p>Emotions {{#if user}}from {{user.username}}{{/if}}</p>
  </div>
  <div class="col s6">
    {{#if ownerRights}}
    <form>
      <div class="input-field">
        <select name="filterEmotions" id="filterEmotions">
          <option value="all" selected>Show all</option>
          <option value="fav">Show favourite</option>
        </select>
        <label for="filterEmotions">Filter by favourites:</label>
      </div>
    </form>
    {{/if}}
  </div>
</div>
<div class="row" id="container-item">
  {{#each emotions}}
  <div class="col s12 m4">
    <div class="card">
      <div class="card-image">
        {{#if ../ownerRights}}
        <img src="{{photo}}" alt="{{emotion}}">
        {{#if favourite}}
        <a class="btn-floating halfway-fab waves-effect waves-light blue" href="/storage/{{user._id}}/{{_id}}/notfav">
          <i class="material-icons" title="Remove from favourite">favorite</i>
        </a>
        {{else}}
        <a class="btn-floating halfway-fab waves-effect waves-light red" href="/storage/{{user._id}}/{{_id}}/fav">
          <i class="material-icons" title="Make favourite">favorite</i>
        </a>
        {{/if}}
        {{/if}}
      </div>
      <div class="card-content">
        <p>Emotion: {{emotion}}</p>
        <a class="btn waves-effect waves-light" href="/storage/{{user._id}}/{{_id}}">Go for Details</a>
        {{#if ../ownerRights}}
        <a class="btn waves-effect waves-light" href="/storage/{{user._id}}/{{_id}}/delete">Delete</a>
        {{/if}}
      </div>
    </div>
  </div>
  {{/each}}
</div>
{{else}}
<div class="row">
  <div class="col s12">
    <p>No emotions to display</p>
  </div>
</div>
{{/if}}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var select = document.querySelectorAll('select');
    var instancesSelect = M.FormSelect.init(select);
  });

  const storage = document
    .querySelector("a[href='/storage/{{owner}}']")
  if (document.location.pathname === "/storage/{{owner}}") {
    storage.setAttribute(
      "aria-hidden", true
    );
  }

  // select on change
  document.getElementById("filterEmotions").onchange = evt => {
    evt.preventDefault();

    axios.post("/storage/{{user._id}}", {
      value: evt.target.value
    }).then(res => {
      let itemBox = ""

      if (res.data.length) {
        res.data.forEach(item => {
          let favButton = ""
          if (JSON.parse(res.config.data).value.toString() === "fav" || item.favourite) {
            favButton = `<a class="btn-floating halfway-fab waves-effect waves-light blue" href="/storage/${item.user._id}/${item._id}/notfav">
          <i class="material-icons" title="Remove from favourite">favorite</i>
        </a>`
          }
          else {
            favButton = `<a class="btn-floating halfway-fab waves-effect waves-light red" href="/storage/${item.user._id}/${item._id}/fav">
          <i class="material-icons" title="Make favourite">favorite</i>
        </a>`
          }

          itemBox += ` <div class="col s12 m4">
    <div class="card">
      <div class="card-image">
        <img src="${item.photo}" alt="${item.emotion}" />
        ${favButton}
      </div>
      <div class="card-content">
        <p>Emotion: ${item.emotion}</p>
        <a class="btn waves-effect waves-light" href="/storage/${item.user._id}/${item._id}">Go for Details</a>
        <a class="btn waves-effect waves-light" href="/storage/${item.user._id}/${item._id}/delete">Delete</a>
      </div>
    </div>
  </div>`
        })
      } else {
        itemBox += `<div class="col s12">
    <p>No emotions to display</p>
  </div>`
      }

      document.getElementById("container-item").innerHTML = itemBox;
    }).catch(err => console.log(`Error: ${err.message}`))
  }
</script>